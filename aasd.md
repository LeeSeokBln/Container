## Cluster, Task definition, Task, Service

### **```Cluster```**
- **ECS에서 작동하는 컨테이너의 논리적 그룹이다.**
- **클러스터는 하나 이상의 EC2 인스턴스 또는 Fargate 인스턴스에서 실행되는 태스크 및 서비스를 호스팅한다.**

### **```Task Definition```**
- **어떤 컨테이너를 실행할 것인지, 그 컨테이너의 특성 및 요구 사항을 정의하는 것입니다.**
- **여러 컨테이너를 하나의 태스크 정의에 정의할 수 있으며, 이들 컨테이너는 함께 실행되고 동일한 네트워크 및 저장소를 공유한다.**

### **```Task```**
- **태스크 정의에서 정의된 하나 이상의 컨테이너의 실행 인스턴스이다.**
- **EC2 인스턴스나 Fargate에서 실행되며, 사용자가 직접 시작하거나 서비스에 의해 시작될 수 있다.**

### **```Service```**
- **태스크의 지정된 수의 복제본이 계속 실행되도록 보장하는 것이다.**
- **서비스는 태스크 정의를 사용하여 태스크를 실행하며, 필요에 따라 로드 밸런서와 연결하여 외부에서 액세스할 수 있게 한다.**
- **서비스는 태스크가 실패할 경우 자동으로 교체 및 확장/축소 기능도 제공한다.**

## EC2 대신 Fargate를 사용하였을 때의 장/단점

### **```장점```**

**서버리스 운영:** 인프라스트럭처 관리의 부담 없이 컨테이너를 실행할 수 있다. EC2 인스턴스를 직접 프로비저닝하거나 관리할 필요가 없다.

**자동 확장:** 워크로드의 요구에 따라 자동으로 확장 및 축소된다.

**비용 효율:** 실행 중인 태스크에 대해서만 비용을 지불하므로 사용한 만큼만 비용이 청구된다.

**보안 강화:** 각 태스크는 자체 격리된 환경에서 실행되므로 다른 태스크와 자원을 공유하지 않는다.

**단순한 배포:** EC2 인스턴스의 용량이나 상태를 걱정할 필요 없이 컨테이너를 배포한다.

### **```단점```**

**비용:** 일부 워크로드에 대해서는 EC2 기반의 ECS를 사용하는 것이 비용 효율적일 수 있다.

**제한된 커스터마이징:** Fargate는 프리패키지된 환경에서 실행되므로 EC2 인스턴스만큼 세밀하게 커스터마이징할 수 없다.

**네트워크 구성 제한:** Fargate를 사용할 때 가능한 VPC 및 네트워크 구성 옵션이 제한적일 수 있다.

**로그와 모니터링:** EC2에서와 동일한 수준의 세부 정보로 시스템 및 네트워크 메트릭을 수집하는 것이 더 복잡할 수 있다.

## Firelens
**ECS의 로그 라우팅 기능이다. 컨테이너화된 애플리케이션의 로그를 캡처하고 사용자 지정 로그 라우팅 및 처리 구성으로 전송하는 기능을 제공한다.**

### **```Firelens의 특징```**

**유연성:** Firelens는 Fluentd와 Fluent Bit, 두 가지 오픈 소스 로깅 백엔드를 지원한다. 이를 통해 로그를 다양한 목적지와 서비스로 라우팅하거나 변환할 수 있다.

**통합:** 기본적으로 ECS의 태스크 정의에 통합되어 있어 쉽게 로그 라우팅 및 처리 설정을 구성할 수 있다.

**사용자 지정 변환:** Fluentd 또는 Fluent Bit의 필터 및 플러그인을 활용하여 로그를 처리, 변환 또는 보강할 수 있다.

**다양한 로그 목적지 지원:** AWS 서비스 뿐만 아니라 다른 서드파티 로깅 서비스로도 로그를 전송할 수 있다.

### **```사용 이유```**

- 다양한 로그 목적지로 로그를 효율적으로 라우팅하고 싶을 때.
- 로그 데이터에 대한 사용자 지정 처리나 변환을 적용하고 싶을 때.
- Fluentd나 Fluent Bit의 다양한 플러그인 및 기능을 활용하여 로깅 전략을 확장하고 싶을 때.

## Service Mesh와 Service Discovery

### **```Service Mesh```**

마이크로서비스 아키텍처에서 서비스 간의 통신을 관리하고 제어하는 dedicated infrastructure layer이다.
서비스 간의 통신을 보안하고, 로드 밸런싱, 회로 차단, 복잡한 트래픽 라우팅, 메트릭 수집 및 추적 등의 기능을 제공한다.

### **```Service Discovery```**

서비스나 애플리케이션의 위치를 자동으로 파악하는 프로세스이다.
마이크로서비스 아키텍처에서 서비스 인스턴스가 동적으로 변경될 수 있기 때문에, 서비스를 찾고 서로 통신하는 데 필요한 정보를 제공하는 것이 중요하다.

### **```ECS에서 사용 가능한 Service Mesh```**

**AWS App Mesh**: AWS에서 제공하는 fully managed service mesh로, ECS, EKS, EC2에서 동작하는 서비스 간의 통신을 쉽게 관리하고 제어할 수 있게 해준다. App Mesh는 Envoy 프록시를 기반으로 한다.

**Istio:** 오픈소스 service mesh로, ECS와 EKS에서도 사용될 수 있다. Istio는 다양한 트래픽 관리, 보안 및 관측 기능을 제공한다.

## ECS로 Stateful 한 서비스를 운영하고자 했을 때 설계 시 주요 고려사항

**데이터 저장**

컨테이너는 일시적이므로 영구적인 데이터 저장에는 외부 저장소가 필요하다.
영구 저장소는 고가용성, 백업 및 복구 전략이 포함되어야 한다.

- **볼륨 관리**

- ECS 작업 정의에서 태스크에 볼륨을 어떻게 마운트할지 결정해야 한다.
- EFS를 사용하여 여러 컨테이너 인스턴스 간에 파일 저장소를 공유할 수 있다.

- **서비스 발견**

서비스의 상태에 따라 동적으로 주소가 변경될 수 있으므로, Service Discovery 메커니즘을 사용하여 서비스 인스턴스를 유연하게 찾을 수 있어야 한다.

- **데이터 백업 및 복구**

정기적인 백업과 빠른 복구를 위한 전략을 세워야 한다.

- **스테이트 관리**

태스크나 서비스가 중단된 후에도 상태를 유지하기 위해, ECS 태스크 배치 전략 및 태스크 배치 제약 조건을 올바르게 구성해야 한다.

- **고가용성**

데이터 손실을 방지하기 위해 다중 AZ 배포, 복제 및 복구 전략을 고려해야 한다.

- **업데이트와 롤백**

데이터의 일관성과 무결성을 유지하기 위해, 서비스를 업데이트하거나 롤백할 때는 주의가 필요하다.
